generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum LicenseStatus {
  ACTIVE
  REVOKED
  EXPIRED
}

enum PaymentEventStatus {
  PENDING
  PROCESSED
  FAILED
}

model User {
  id               String    @id @default(uuid())
  email            String    @unique
  stripeCustomerId String?   @unique
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  licenses         License[]
}

model License {
  id              String        @id @default(uuid())
  // Public key part for verification
  publicKey       String        @unique 
  // Hashed private key for issuance (never stored in plaintext)
  hashedKey       String
  userId          String
  status          LicenseStatus @default(ACTIVE)
  features        Json          // e.g. ["4k-streaming", "priority-support"]
  expiresAt       DateTime?
  lastValidatedAt DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  user User @relation(fields: [userId], references: [id])
}

model PaymentEvent {
  id        String             @id @default(uuid())
  stripeId  String             @unique
  type      String             // e.g. "checkout.session.completed"
  payload   Json
  status    PaymentEventStatus @default(PENDING)
  createdAt DateTime           @default(now())
  processedAt DateTime?
  error     String?
}
